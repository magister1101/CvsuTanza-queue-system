import{Q as X,a as y}from"./QPage-DPsZlzTf.js";import{f as n,u as Y,k as Z,r as N,o as m,b as P,w as l,N as x,e as s,a as o,i as C,c as v,Q as p,j as ee,m as $,n as te,F as V,g as S,h as I,t as D}from"./index-BMhglyKV.js";import{Q as z}from"./QTooltip-DY0LP1Dx.js";import{Q as oe,a as se}from"./QTable-82CfmyBW.js";import{Q as ae}from"./QTr-DrqNJx8U.js";import{Q as q}from"./QInput-CefROznu.js";import{Q as le}from"./QSelect-BXUjDScj.js";import{Q as E}from"./QCardActions-BouhufK_.js";import{Q as j}from"./QForm-RWsXu0Um.js";import{Q as B}from"./QCard-Dna_0p2Q.js";import{Q as F}from"./QDialog-CdgP6t9L.js";import{a as f}from"./axios-upsvKRUO.js";import{_ as re}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./use-prevent-scroll-NfEf-uE_.js";import"./scroll-BbPNP22x.js";import"./use-timeout-FgPeAw9M.js";import"./format-DKTbQgkX.js";import"./use-dark-xojyzzLc.js";import"./QList-Q1GbiNYp.js";import"./use-key-composition-BODgx2F7.js";const ie={class:"main-container"},ne={class:"content-container q-px-md q-px-sm-xl"},ue={key:0,class:"button-container"},de={class:"q-mt-lg"},me={key:0,class:"row q-gutter-x-sm"},ce=["title"],pe={class:"q-pa-md"},fe={class:"row q-col-gutter-md"},ve={class:"col-12"},ge={class:"input-field"},be={class:"row q-col-gutter-md"},ye={class:"col-12 col-sm-4"},Ce={class:"input-field"},qe={class:"col-12 col-sm-4"},xe={class:"input-field"},he={class:"col-12 col-sm-4"},we={class:"input-field"},_e={class:"row q-col-gutter-md"},ke={class:"col-12"},Ve={class:"input-field"},Qe={__name:"addCourses",setup(Te){const c=n(!1),M=Y(),g=n(!1),b=n(!1),Q=n(null);n(""),n(""),n(!1);const h=n(""),T=n([{name:"#",required:!0,label:"#",align:"center",field:"index",sortable:!0},{name:"courseCode",required:!0,label:"Course Code",align:"left",field:"courseCode",sortable:!0},{name:"courseName",align:"left",label:"Course Name",field:"courseName",sortable:!0},{name:"courseTitle",align:"left",label:"Program",field:"courseTitle",sortable:!0},{name:"numUnits",align:"left",label:"Total Number of Units",field:"numUnits",sortable:!0},{name:"description",align:"left",label:"Description",field:"description",sortable:!0},{name:"prerequisite",align:"left",label:"Prerequisite",field:"prerequisite",sortable:!0},{name:"action",align:"center",label:"Action",field:"action"}]),w=n([]),U=n({}),i=n({courseTitle:null,courseCode:"",numUnits:"",description:""}),A=n(""),_=n(""),R=n("");async function W(){try{const a=localStorage.getItem("authToken"),e=await f.get("https://pre-registration-and-queueing-system-be.vercel.app/courses/getProgram?isArchived=false",{headers:{Authorization:a}});U.value=e.data.map(d=>d.name)}catch(a){console.error(a)}}async function k(){try{const a=localStorage.getItem("authToken"),e=await f.get("https://pre-registration-and-queueing-system-be.vercel.app/users/myProfile",{headers:{Authorization:a}});if(e.data.role==="admin"||e.data.role==="osas"||e.data.role==="cashier"||e.data.role==="registrar"){const d=await f.get("https://pre-registration-and-queueing-system-be.vercel.app/courses?isArchived=false",{headers:{Authorization:a}});w.value=d.data.map((r,t)=>({index:t+1,courseCode:r.code,courseTitle:r.course,courseName:r.name,description:r.description,prerequisite:r.prerequisite.length?r.prerequisite.map(u=>u.code).join(", "):"",numUnits:r.unit||0,action:r._id}))}else{const d=await f.get(`https://pre-registration-and-queueing-system-be.vercel.app/courses?program=${e.data.role}&isArchived=false`,{headers:{Authorization:a}});w.value=d.data.map((r,t)=>({index:t+1,courseCode:r.code,courseTitle:r.course,courseName:r.name,description:r.description,prerequisite:r.prerequisite.length?r.prerequisite.map(u=>u.code).join(", "):"",numUnits:r.unit||0,action:r._id}))}}catch(a){console.error("Error fetching programs:",a)}}function L(a){i.value={courseTitle:a.courseTitle,courseName:a.courseName,courseCode:a.courseCode,numUnits:a.numUnits,description:a.description,action:a.action},g.value=!0}async function O(a){c.value=!0;try{const e=localStorage.getItem("authToken"),d=await f.post(`https://pre-registration-and-queueing-system-be.vercel.app/courses/updateCourse/${a}`,{code:i.value.courseCode,course:i.value.courseTitle,name:i.value.courseName,description:i.value.description,unit:i.value.numUnits},{headers:{Authorization:e,"Content-Type":"application/json"}});x.create({type:"positive",message:"course edited"}),g.value=!1}catch(e){console.error(e)}finally{k(),c.value=!1}}function G(a){Q.value=a,b.value=!0}async function H(a){c.value=!0;try{const e=localStorage.getItem("authToken");await f.post(`https://pre-registration-and-queueing-system-be.vercel.app/courses/updateCourse/${a}`,{isArchived:!0},{headers:{Authorization:e,"Content-Type":"application/json"}}),x.create({type:"positive",message:"Course deleted"}),k(),b.value=!1}catch(e){console.error(e),x.create({type:"negative",message:"Something Went Wrong"})}finally{c.value=!1}}async function J(){const a=localStorage.getItem("authToken");try{const e=await f.get("https://pre-registration-and-queueing-system-be.vercel.app/users/myProfile",{headers:{Authorization:a}});return A.value=e.data.role,A.value==="admin"?_.value=!0:R.value=!0}catch(e){console.error(e),x.create({type:"negative",message:"Error fetching user information"})}}return Z(()=>{k(),W(),J()}),(a,e)=>{const d=N("q-card-title"),r=N("q-card-main");return m(),P(X,{style:{height:"90vh"}},{default:l(()=>[s("div",ie,[s("div",ne,[o(y,{class:"q-pt-md"},{default:l(()=>e[13]||(e[13]=[s("div",{class:"text-h6 text-weight-medium",style:{color:"#282726"}},[C(" Admin/"),s("span",{style:{color:"#b1b2b4"}},"Courses")],-1)])),_:1}),_.value?(m(),v("div",ue,[o(y,{class:"button-section"},{default:l(()=>[o(p,{label:"Add Course","no-caps":"",flat:"",class:"action-button",onClick:e[0]||(e[0]=t=>ee(M).push("/new/addProgramPage"))})]),_:1})])):$("",!0),s("div",de,[o(oe,{style:{"border-radius":"14px","background-color":"#fdffdf"},title:"Program Information",rows:w.value,columns:T.value,"row-key":"id",separator:"cell",filter:h.value,"rows-per-page-options":[0,5,10,15,20],class:"responsive-table"},{body:l(t=>[o(ae,{props:t},{default:l(()=>[(m(!0),v(V,null,te(T.value,u=>(m(),P(se,{key:u.name,props:t},{default:l(()=>[u.name==="#"?(m(),v(V,{key:0},[C(D(t.rowIndex+1),1)],64)):u.name==="action"?(m(),v(V,{key:1},[_.value?(m(),v("div",me,[o(p,{flat:"",dense:"",size:"sm",icon:"edit",color:"primary",onClick:K=>L(t.row)},{default:l(()=>[o(z,null,{default:l(()=>e[14]||(e[14]=[C("Edit")])),_:1})]),_:2},1032,["onClick"]),o(p,{flat:"",dense:"",size:"sm",loading:c.value,icon:"delete",color:"negative",onClick:K=>G(t.row.action)},{default:l(()=>[o(z,null,{default:l(()=>e[15]||(e[15]=[C("Delete")])),_:1})]),_:2},1032,["loading","onClick"])])):$("",!0)],64)):(m(),v("span",{key:2,title:t.row[u.name]},D(t.row[u.name]?.length>50?t.row[u.name].slice(0,50)+"...":t.row[u.name]),9,ce))]),_:2},1032,["props"]))),128))]),_:2},1032,["props"])]),"top-left":l(()=>[o(q,{borderless:"",dense:"",debounce:"300",modelValue:h.value,"onUpdate:modelValue":e[1]||(e[1]=t=>h.value=t),placeholder:"Search"},{append:l(()=>[o(S,{name:"search"})]),_:1},8,["modelValue"])]),_:1},8,["rows","columns","filter"])]),s("div",null,[o(F,{modelValue:g.value,"onUpdate:modelValue":e[9]||(e[9]=t=>g.value=t),persistent:""},{default:l(()=>[o(B,{style:{width:"800px","max-width":"95vw"}},{default:l(()=>[o(j,{onSubmit:e[8]||(e[8]=I(t=>O(i.value.action),["prevent"]))},{default:l(()=>[s("div",pe,[o(y,{class:"text-h6 text-weight-medium",style:{color:"#282726"}},{default:l(()=>e[16]||(e[16]=[C(" Edit Program ")])),_:1}),o(y,null,{default:l(()=>[s("div",fe,[s("div",ve,[e[17]||(e[17]=s("div",{class:"text-subtitle2 q-mb-sm"},"Course Name",-1)),s("div",ge,[o(q,{modelValue:i.value.courseName,"onUpdate:modelValue":e[2]||(e[2]=t=>i.value.courseName=t),type:"text",borderless:""},null,8,["modelValue"])])])]),s("div",be,[s("div",ye,[e[18]||(e[18]=s("div",{class:"text-subtitle2 q-mb-sm"},"Program",-1)),s("div",Ce,[o(le,{modelValue:i.value.courseTitle,"onUpdate:modelValue":e[3]||(e[3]=t=>i.value.courseTitle=t),type:"text",borderless:"",options:U.value},null,8,["modelValue","options"])])]),s("div",qe,[e[19]||(e[19]=s("div",{class:"text-subtitle2 q-mb-sm"},"Course Code",-1)),s("div",xe,[o(q,{modelValue:i.value.courseCode,"onUpdate:modelValue":e[4]||(e[4]=t=>i.value.courseCode=t),type:"text",borderless:""},null,8,["modelValue"])])]),s("div",he,[e[20]||(e[20]=s("div",{class:"text-subtitle2 q-mb-sm"},"Total Units",-1)),s("div",we,[o(q,{modelValue:i.value.numUnits,"onUpdate:modelValue":e[5]||(e[5]=t=>i.value.numUnits=t),type:"number",borderless:""},null,8,["modelValue"])])])]),s("div",_e,[s("div",ke,[e[21]||(e[21]=s("div",{class:"text-subtitle2 q-mb-sm"},"Course Description",-1)),s("div",Ve,[o(q,{modelValue:i.value.description,"onUpdate:modelValue":e[6]||(e[6]=t=>i.value.description=t),type:"textarea",borderless:""},null,8,["modelValue"])])])])]),_:1}),o(E,{align:"right"},{default:l(()=>[o(p,{flat:"",label:"Cancel",onClick:e[7]||(e[7]=t=>g.value=!1),color:"red-8",class:"q-px-md"}),o(p,{loading:c.value,type:"submit",flat:"",label:"Save",class:"q-px-md",style:{"background-color":"#306b30",color:"#ffffff",width:"100px"}},null,8,["loading"])]),_:1})])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),s("div",null,[o(F,{modelValue:b.value,"onUpdate:modelValue":e[12]||(e[12]=t=>b.value=t),persistent:""},{default:l(()=>[o(B,null,{default:l(()=>[o(j,{onSubmit:e[11]||(e[11]=I(t=>H(Q.value),["prevent"]))},{default:l(()=>[o(y,null,{default:l(()=>[o(d,null,{default:l(()=>[o(S,{name:"warning",color:"negative"}),e[22]||(e[22]=s("div",{class:"text-h6"},"Delete Program?",-1))]),_:1}),o(r,null,{default:l(()=>e[23]||(e[23]=[s("div",{class:"text-subtitle1"},"Are you sure you want to delete this Course?",-1)])),_:1}),o(E,{align:"right"},{default:l(()=>[o(p,{flat:"",label:"Cancel",onClick:e[10]||(e[10]=t=>b.value=!1),color:"red-8",class:"q-px-md"}),o(p,{loading:c.value,flat:"",label:"Delete",color:"negative",type:"submit",class:"q-px-md"},null,8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])])])])]),_:1})}}},Je=re(Qe,[["__scopeId","data-v-8bdb048b"]]);export{Je as default};
