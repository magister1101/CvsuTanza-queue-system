import{Q as E,a as f}from"./QPage-DPsZlzTf.js";import{Q as V,b as S,c as N,a as u}from"./QTable-82CfmyBW.js";import{Q as x}from"./QTr-DrqNJx8U.js";import{p as M,u as R,f as r,l as D,k as L,o as g,b as _,w as t,N as d,e as c,a,h as O,c as G,n as H,F as J,g as K,i as n,t as i,m as j,Q as W}from"./index-BMhglyKV.js";import{Q as X}from"./QInput-CefROznu.js";import{Q as Y}from"./QTooltip-DY0LP1Dx.js";import{Q as Z}from"./QSpace-n_TQuSIW.js";import{Q as ee}from"./QForm-RWsXu0Um.js";import{a as v}from"./axios-upsvKRUO.js";import{_ as te}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./use-dark-xojyzzLc.js";import"./QList-Q1GbiNYp.js";import"./QSelect-BXUjDScj.js";import"./use-key-composition-BODgx2F7.js";import"./format-DKTbQgkX.js";import"./use-prevent-scroll-NfEf-uE_.js";import"./scroll-BbPNP22x.js";import"./QDialog-CdgP6t9L.js";import"./use-timeout-FgPeAw9M.js";const ae={class:"full-height"},se={class:"bg-container",style:{background:`url('https://res.cloudinary.com/dqaw6ndtn/image/upload/v1737617278/assets/queing/q5xrh22iplhm2bndvvru.jpg')
            no-repeat center center`,"background-size":"cover",border:"3px solid #606060"}},le={class:"content-wrapper"},oe={style:{display:"flex",width:"100%"},class:"q-mt-md"},re={class:"q-ml-md"},ne={__name:"queueCourse",setup(ie){const T=M(),P=R(),b=r(!1),w=T.params.studentId;T.params.userId;const m=r(!1),h=r([]),q=r(!1),y=r([]),I=r(null),k=r(""),p=r([]),$=r([{name:"code",label:"Course Code",align:"left",field:"code"},{name:"name",label:"Course Name",align:"left",field:"name"},{name:"unit",label:"Units",align:"left",field:"unit"},{name:"course",label:"Program",align:"left",field:"course"},{name:"prerequisites",label:"Prerequisites",align:"left",field:"prerequisites"},{name:"description",label:"Description",align:"left",field:s=>s.description.length>50?s.description.substring(0,50)+"...":s.description}]),C=r([]),A=r([{name:"course",label:"Selected Course",align:"left",field:"course"},{name:"prerequisites",label:"Missing Prerequisites",align:"left",field:"prerequisites"}]);async function z(){m.value=!0;try{const s=localStorage.getItem("authToken");(await v.post(`https://pre-registration-and-queueing-system-be.vercel.app/users/sendEmail/${w}`,{},{headers:{"Content-Type":"application/json",authorization:s}})).status===200&&d.create({type:"positive",message:"Email sent successfully"})}catch(s){console.error(s),d.create({type:"negative",message:"Failed to send email"})}finally{m.value=!1}}async function F(){b.value=!0;try{const s=await v.get(`https://pre-registration-and-queueing-system-be.vercel.app/users?query=${w}`);console.log(s.data[0].course);const l=localStorage.getItem("Authtoken"),e=await v.get(`https://pre-registration-and-queueing-system-be.vercel.app/courses?isArchived=false&program=${s.data[0].course}`,{headers:{"Content-Type":"application/json",authorization:l}});e.data&&Array.isArray(e.data)?p.value=e.data.map(o=>({...o,prerequisites:o.prerequisite&&o.prerequisite.length>0?o.prerequisite.map(Q=>Q.code).join(", "):"None"})):(console.error("Invalid response format:",e),p.value=[],d.create({type:"negative",message:"Invalid data format received from server"}))}catch(s){console.error(s),p.value=[],d.create({type:"negative",message:"Failed to fetch courses data"})}finally{b.value=!1}}async function U(){m.value=!0;try{if(y.value.length<=0){d.create({type:"warning",message:"Please select at least one course to take"});return}const s=localStorage.getItem("authToken"),l=await v.post("https://pre-registration-and-queueing-system-be.vercel.app/queues/checkPrerequisites",{studentId:w,selectedCourses:y.value},{headers:{"Content-Type":"application/json",Authorization:s}});if(l.data.missing)C.value=Object.entries(l.data.missingPrerequisites).map(([e,o])=>({id:e,course:e,prerequisites:o.map(Q=>Q.name).join(", ")})),d.create({type:"negative",message:l.data.message});else{C.value=[],d.create({type:"positive",message:l.data.message});const e=await v.post("https://pre-registration-and-queueing-system-be.vercel.app/queues/createQueue",{selectedCourses:y.value},{headers:{"Content-Type":"application/json",authorization:s}});z(),P.replace("/new/addStudent/")}I.value=l.data}catch(s){console.error(s),d.create({type:"negative",message:"Failed to update courses"})}finally{m.value=!1}}const B=s=>{h.value=s?[...p.value]:[]};return D(h,s=>{y.value=s.map(l=>l._id),q.value=s.length===p.value.length}),L(()=>{F()}),(s,l)=>(g(),_(E,null,{default:t(()=>[c("div",ae,[c("div",se,[a(f,{class:"flex flex-center q-pa-md"},{default:t(()=>[c("div",le,[a(f,{class:"text-center q-pt-lg"},{default:t(()=>l[3]||(l[3]=[c("div",{class:"text-h4 text-weight-bold text-uppercase"},"Course to Take",-1)])),_:1}),a(f,{class:"container-courseInfo"},{default:t(()=>[a(ee,{onSubmit:O(U,["prevent"])},{default:t(()=>[a(V,{class:"courseTable",rows:p.value,loading:b.value,columns:$.value,filter:k.value,separator:"cell","row-key":"_id",selection:"multiple",selected:h.value,"onUpdate:selected":l[2]||(l[2]=e=>h.value=e)},{header:t(e=>[a(x,{props:e},{default:t(()=>[a(S,{"auto-width":""},{default:t(()=>[a(N,{modelValue:q.value,"onUpdate:modelValue":[l[0]||(l[0]=o=>q.value=o),B]},null,8,["modelValue"])]),_:1}),(g(!0),G(J,null,H(e.cols,o=>(g(),_(S,{key:o.name},{default:t(()=>[n(i(o.label),1)]),_:2},1024))),128))]),_:2},1032,["props"])]),"top-left":t(()=>[a(X,{borderless:"",dense:"",debounce:"300",modelValue:k.value,"onUpdate:modelValue":l[1]||(l[1]=e=>k.value=e),placeholder:"Search"},{append:t(()=>[a(K,{name:"search"})]),_:1},8,["modelValue"])]),body:t(e=>[a(x,{props:e},{default:t(()=>[a(u,{"auto-width":""},{default:t(()=>[a(N,{modelValue:e.selected,"onUpdate:modelValue":o=>e.selected=o},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),a(u,null,{default:t(()=>[n(i(e.row.code),1)]),_:2},1024),a(u,null,{default:t(()=>[n(i(e.row.name),1)]),_:2},1024),a(u,null,{default:t(()=>[n(i(e.row.unit),1)]),_:2},1024),a(u,null,{default:t(()=>[n(i(e.row.course),1)]),_:2},1024),a(u,null,{default:t(()=>[n(i(e.row.prerequisites),1)]),_:2},1024),a(u,null,{default:t(()=>[e.row.description.length>50?(g(),_(Y,{key:0},{default:t(()=>[n(i(e.row.description),1)]),_:2},1024)):j("",!0),n(" "+i(e.row.description.length>50?e.row.description.substring(0,50)+"...":e.row.description),1)]),_:2},1024)]),_:2},1032,["props"])]),_:1},8,["rows","loading","columns","filter","selected"]),c("div",oe,[a(Z),c("div",re,[a(W,{loading:m.value,type:"submit",icon:"arrow_forward",size:"19px",style:{width:"70px",height:"70px",color:"#ffffff","background-color":"#31562d","border-radius":"50%"}},null,8,["loading"])])])]),_:1}),a(f,null,{default:t(()=>l[4]||(l[4]=[c("div",null,"Take Note, Select Course To Take.",-1)])),_:1}),I.value?(g(),_(f,{key:0,style:{border:"3px solid #606060","background-color":"#ffffff"}},{default:t(()=>[c("div",null,[a(V,{style:{"box-shadow":"none"},rows:C.value,columns:A.value,"row-key":"id","rows-per-page-options":[0],separator:"cell"},{body:t(e=>[a(x,{props:e},{default:t(()=>[a(u,null,{default:t(()=>[n(i(e.row.course),1)]),_:2},1024),a(u,null,{default:t(()=>[n(i(e.row.prerequisites),1)]),_:2},1024)]),_:2},1032,["props"])]),_:1},8,["rows","columns"])])]),_:1})):j("",!0)]),_:1})])]),_:1})])])]),_:1}))}},Ie=te(ne,[["__scopeId","data-v-d6dc9a12"]]);export{Ie as default};
